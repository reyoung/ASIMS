require(["admin/active"],function(f){$(function(){function b(){$("#StopOver").val(1)}function d(){rmId=$(this).attr("stopovers-id");curData=JSON.parse($("#Stopovers").val());for(i=i=0;i<curData.length&&curData[i]!=rmId;++i);curData.splice(i,1);$("#Stopovers").val(JSON.stringify(curData));tr=$(this)[0].parentNode.parentNode;tbody=tr.parentNode;tbody.removeChild(tr)}f("nav_airlinePlan_create");$("#datetimepicker").datetimepicker({language:"en"});if(""!=$("#Repeat").val())if(repeat=$("#Repeat").val(),
"W"==repeat[0]){$("#RepeatSettings li:eq(1) a").tab("show");for(i=1;i<repeat.length;++i)$("#week"+repeat[i]).attr("checked","checked")}else"M"==repeat[0]&&($("#RepeatSettings li:eq(2) a").tab("show"),repeat.replace("M",""),$("#month").val(repeat));Stopovers=$("#StopoversInput tbody a.btn");data=[];for(i=0;i<Stopovers.length;++i)rmId=$(Stopovers[i]).attr("stopovers-id"),data.push(rmId);$("#Stopovers").val(JSON.stringify(data));$("#stopover_cls_btn").click(b);$("#Stopover_Add").click(function(){add_id=
$("#StopOver").val();(function(a){curData=$("#Stopovers").val();curData=""==curData?[]:JSON.parse(curData);curData.push(a);$("#Stopovers").val(JSON.stringify(curData))})(add_id);(function(a){tbody=$("#StopoversInput table tbody");originText=tbody.html();name=$("#StopOver option[value="+a+"]").text();tbody.html(originText+"<tr><td>"+name+'</td><td><a href="#" stopovers-id="'+a+'" class="btn"><i class="icon-minus"></i> </a> </td></tr>')})(add_id);b();$("#Stopover_Modal").modal("hide");$("#StopoversInput tbody a.btn").click(d)});
$("#StopoversInput tbody a.btn").click(d);$("form.form-horizontal").submit(function(a){var b=$("#Number").val(),g=$("#LeaveTime").val(),c=$("#FlyTime").val(),d=$("#LeavePlace").val(),f=$("#ArrivePlace").val();$("#StopoversInput.tbody").val();for(var h=$("#month").val(),k=[],l=0,e=1;7>=e;e++)"checked"==$("#week"+e).attr("checked")&&(k[l++]=e);if(null==b||0==b.length)a.preventDefault(),$("span.help-inline:eq(0)").text("机场名不能为空"),$("div.control-group:eq(0)").attr("class","control-group error");null==
g||0==g.length?(a.preventDefault(),$("span.help-inline:eq(1)").text("起飞日期不能为空"),$("div.control-group:eq(1)").attr("class","control-group error")):/^((?:19|20)\d\d)\/(0[1-9]|[012])\/(0[1-9]|[12][0-9]|3[01])\s([01][0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9]$/.test(g)||(a.preventDefault(),$("span.help-inline:eq(1)").text("起飞日期输入格式不正确"),$("div.control-group:eq(1)").attr("class","control-group error"));if(null==c||0==c.length)a.preventDefault(),$("span.help-inline:eq(2)").text("起飞时间不能为空"),$("div.control-group:eq(2)").attr("class",
"control-group error");else if(1>c||parseInt(c)!=c)a.preventDefault(),$("span.help-inline:eq(2)").text("飞行时间应该大于1且为整数"),$("div.control-group:eq(2)").attr("class","control-group error");d==f&&(a.preventDefault(),$("span.help-inline:eq(3)").text("始发地和目的地不能相同"),$("div.control-group:eq(3)").attr("class","control-group error"),$("span.help-inline:eq(4)").text("始发地和目的地不能相同"),$("div.control-group:eq(4)").attr("class","control-group error"));$("#Number,#LeaveTime,#FlyTime,#LeavePlace,#ArrivePlace").focus(function(){$("span.help-inline").text("");
$("div").hasClass("control-group error")&&$("div.control-group.error").attr("class","control-group")});0!=k.length?$("#Repeat").val("W"+k.join("")):null!=h&&0!=h.length?$("#Repeat").val("M"+h):$("#Repeat").val("N")})})});
